define(function(require){"use strict";var EventEmitter=require("drc/lib/EventEmitter.min"),_=require("lodash"),RequestHandler=require("RequestHandler"),StoreBase=_.merge(EventEmitter.prototype,{requestData:function(id,filters,callback){var requestModel=this.collection[id];RequestHandler.request(requestModel.url,filters,function(data){requestModel.onDataReceived(data),callback()},function(){requestModel.errorFunction(),callback(!0)})},emitChange:function(namespace){var args=Array.prototype.slice.call(arguments,1);args.unshift("change"),this.emit.apply(this,args),null!==namespace&&void 0!==namespace&&(args[0]="change:"+namespace,this.emit.apply(this,args))},emitFail:function(namespace){var args=Array.prototype.slice.call(arguments,1);args.unshift("fail"),this.emit.apply(this,args),null!==namespace&&void 0!==namespace&&(args[0]="fail:"+namespace,this.emit.apply(this,args))},shouldHandleAction:function(actionComponent){return _.isString(this.componentType)?actionComponent===this.componentType:_.isArray(this.componentType)?_.contains(this.componentType,actionComponent):!0},handleRequestDataAction:function(action){var id=action.id;this.shouldHandleAction(action.component)&&(_.find(this.collection,id)||this.collection[id]||this.createInstance(id,action.data.definition,action.data.dataFormatter),"REQUEST_DATA"===action.actionType&&this.requestData(id,action.data.filters,_.bind(function(error){error?this.emitFail(id):this.emitChange(id)},this)))}});return StoreBase});
